- name: create kibana group
  group: name=kibana

- name: create kibana user
  user: name=kibana group=kibana

- name: download kibana
  get_url: url=https://artifacts.elastic.co/downloads/kibana/kibana-6.3.0-linux-x86_64.tar.gz dest=/tmp timeout=60 checksum=sha512:8d83a41389a75463e810644a8e2dbbd7bba0a3c55aec25189f7f56dadfe6f4879e03d27ff65a87e2beb0c7e635e09b0a5669b6ce75323169b937cd754fabe1a7

- name: extract kibana
  unarchive: src=/tmp/kibana-6.3.0-linux-x86_64.tar.gz dest=/opt/ copy=no owner=kibana group=kibana

- name: update /opt/kibana/config/kibana.yml
  copy: src=opt/kibana/config/kibana.yml dest=/opt/kibana-6.3.0-linux-x86_64/config/kibana.yml

- name: update /etc/systemd/system/kibana.service
  copy: src=etc/systemd/system/kibana.service dest=/etc/systemd/system/kibana.service

- name: enable kibana service
  service: name=kibana enabled=yes
